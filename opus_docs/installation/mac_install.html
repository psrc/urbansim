
<!Doctype HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html> 


  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link href="../style/book.css" rel="stylesheet" type="text/css">
    <base target="_top">
    <title>Installation instructions for Mac</title>
  </head>

  <body>
    <!-- HEAD BANNER BEGINS HERE :: to be placed immediately below body tag -->
    <table border="0" cellspacing="0" width="100%">
      <tbody>
    <tr>
      <td><a href="http://www.urbansim.org/"><img src="images/new-logo-medium.gif" border="0" height="45" width="105" alt="urbansim logo"></a></td>
    </tr>
    <tr>
      <td colspan="2" class="breadcrumbbox" bgcolor="#eeeeee" width="100%"><a href="index.html">Installing Opus &amp; UrbanSim</a> &gt;
        Installing on Mac</td>
    </tr>
      </tbody>
    </table>
    <!-- HEAD BANNER ENDS HERE -->
    
    <h1>
      Installing Opus &amp; UrbanSim on Mac OS X
    </h1>
    <font size=4></font>
    <p>
      The following instructions are for installing Opus and UrbanSim
      on&nbsp;Mac OS X. The directions have been tested with Mac OS X
      Leopard (10.5) with an Intel processor.  In the past we have also 
      run UrbanSim on a Mac with a PPC processor, but haven't tested the
      instructions recently for that processor.
    </p>

    <ol>
      <li><a href="#python">Installing Python</a></li>
      <li><a href="#mysql">Installing MySQL</a> (optional)</li>
      <li><a href="#libraries">Installing Python libraries and Qt</a></li>
      <li><a href="#opus">Installing Opus and UrbanSim</a></li>
      <li><a href="#environment">Defining Environment Variables for Opus and UrbanSim</a></li>
      <li><a href="#test">Testing your installation</a></li>
    </ol>


    <h2>
      Step 1: <a name=python>Installing Python</a>
    </h2>
    <p>
      Opus and UrbanSim are implemented in Python, making heavy use of external
      numerical Python packages and other software. The version used in this guide
      is 2.5.1. If you use OS X Leopard (10.5), this version is already installed and you
      can skip to the next section. If you are using an earlier version of OS X
      however, you'll need to update Python.
    </p>

    <p>
      The <a href="http://www.python.org">official Python
    website</a>
      includes <a href="http://www.python.org/doc/">documentation</a>,
      <a href="http://www.python.org/download/">downloads</a>, and
      much more. Go to
      the <a href="http://www.python.org/download/">download
    section</a> and get the latest version of Python 2.5 (at the
      time of writing 2.5.2) for Mac OS X. This is an
      installer that works on both PPC and Intel
      Macs. Double-click on the image to mount it, then
      double-click on the MacPython.mpkg package icon to
      install. When you're done you can unmount the image by
      clicking on the triangle symbol next to it in the Finder.
    </p>
    <p>
      When you install a newer version of Python, the installer will put it earlier
      on the search path so that it will be found instead of the preinstalled one.
      You can still get to the old version via
      <tt>/usr/bin/python</tt>. We recommend that you keep the old version, since other
      applications may rely on it.
    </p>


    <h2>
      Step 2 (optional): <a name=mysql>Installing MySQL</a>
    </h2>
    <p>
      MySQL is an efficient, open-source SQL database. You don't need it to run the
      basic Eugene tutorial, although for serious use with your own dataset you will
      want a database of some sort. We are steadily reducing the dependencies on the
      particular database used with the goal of allowing Opus and UrbanSim to be
      used with any SQL database, but for now MySQL is probably your best option.
    </p>
    <p>
      If you use MySQL you can either have a local copy or run on a shared server.
      You can also return and install MySQL later if you discover that you need it.
    </p>
    <p>
      Opus works with MySQL 4.1 and 5.0.
    </p>
    <ol>
      <li>
    Choose which version of MySQL to use, and download the binary installer for
    your version of the OS and processor type from
    <a href="http://dev.mysql.com/downloads/">MySQL Downloads</a>.
      </li>
      <li>
    Install and configure MySQL.
      </li>
    </ol>
    <p>
      In addition to MySQL itself, you might get the
      <a href="http://www.mysql.com/products/tools/query-browser/">MySQL Query
    Browser</a> for prowling around in UrbanSim databases using a graphical
      interface, and the
      <a href="http://www.mysql.com/products/tools/administrator/">MySQL
    Administrator</a>. These are both available as binaries.
    </p>
    <p>
      See the <a href="mysqlinstall.4.1.html">Opus/UrbanSim MySQL Installation and
    Configuration Page</a> for additional specific configuration steps. &nbsp;This
      page is written for Windows, but is straightforward to use for the Mac as
      well.
    </p>


    <h2>
      Step 3: <a name=libraries>Installing Python Libraries and Qt</a>
    </h2>

<p>Opus and Urbansim require a number of python packages, and make optional
use of several others.  Download and install them from the list
of <a href="python_packages.html">required, recommended and optional Python
packages</a>.  Many packages have multiple versions, and are sometimes
available in both dmg form and source.  If you get a dmg (disk image) file,
be sure to pick the one for Python 2.5.  In addition to the general
instructions at the above link, here are some additional Mac-specific
suggestions for installing the libraries.</p>

    <h3>
      3.1 Prerequisites
    </h3>
    
    <p>
    In order to install some of the packages, you'll need to compile the library
    from source. If you haven't already done so, you can install the optional Xcode
    package on one of the Install Disks that came with your Mac (for Mac OS X Leopard (10.5) it's
    Install Disk 2). You'll find the installation file named
    <tt>XcodeTools-<i>version</i>.mpkg</tt>
    inside the <tt>Xcode Tools</tt> folder on
    the installation disc.
    </p>
    <p>
      If you have an older Mac, you may need to get a more up-to-date version of
      Xcode Tools than the one that came on your Install Disk. In particular if you
      get C compiler errors (such as not being able to find 'include' files), this
      may be the problem. To fix it, get the latest version of Xcode Tools from the
      <a href="http://developer.apple.com/tools/download/">Apple Tools Download
    page</a>. You'll need to register (it's free) and login. A warning about the
      file size; it's over 900 MB.
    </p>
    <p>
    Unfortunately Xcode doesn't come with a Fortran compiler, which is needed to
    build the SciPy package. You can download the GNU Fortran compiler from
    <a href="http://r.research.att.com/gfortran-4.2.3.dmg">http://r.research.att.com/gfortran-4.2.3.dmg</a>. The installation should be straightforward.
    </p>
    
    <p>
    You can make a quick check that the compilers are installed by typing the commands
    </p>
    
    <pre>
      $ gcc --version
      $ gfortran --version</pre>

    <p>
    and make sure that you get version information and not command not found errors.
    </p>
    
    <h3>
      3.2 Installing the required packages
    </h3>

<p>Generally we recommend that you use Easy Install. EasyInstall is a
Python module that can download, build (if necessary) and install Python
packages with minimal user interaction. For more on Easy Install,
<a href="http://peak.telecommunity.com/DevCenter/EasyInstall">visit the PEAK
webpage</a>.  However, if EasyInstall doesn't work, or is over-eager to
build some packages from source that are also available as dmg files, get
these packages from the download site for that package (linked below for
each package) or from
<a href="http://pythonmac.org/packages/py25-fat/index.html">pythonmac.org</a>.
</p>

    <p>
    To install it; download
    <a href="http://peak.telecommunity.com/dist/ez_setup.py">ez_setup.py</a> to your
    computer. Open a Terminal and locate the directory the file is in. Then type
    </p>
    <pre>
      $ sudo python ez_setup.py</pre>
    <p>
      If you are running a version of OS X earlier than 10.5, such as 10.4.9,
      download and install the following
    </p>
    <ul>
      <li><b>pytz</b> from <a href="http://pythonmac.org/packages/py25-fat/index.html">the downloads page on pythonmac.org</a>.</li>
      <li><b>python-dateutil</b>, also from <a href="http://pythonmac.org/packages/py25-fat/index.html">pythonmac.org</a>.</li>
    </ul>
    
    <p>
    If you are running Mac OS X Leopard (10.5), the two packages above are not necessary.
    </p>
    
    <p>
    Install <a href="http://numpy.scipy.org/">NumPy</a>,
    <a href="http://www.scipy.org/">SciPy</a>,
    <a href="http://matplotlib.sourceforge.net/">MatPlotLib</a>,
    <a href="http://www.sqlalchemy.org/">SQLAlchemy</a> and
    <a href="http://elixir.ematia.de/trac/wiki">Elixir</a> by
    typing the following commands in a Terminal window:
    </p>
    
    <pre>
      $ sudo easy_install numpy
      $ sudo easy_install scipy
      $ sudo easy_install matplotlib
      $ sudo easy_install SQLAlchemy
      $ sudo easy_install Elixir</pre>
    
    <p>
    If for some reason <tt>easy_install</tt>
    fails to install any of the above packages, or if you do not want to use
    <tt>easy_install</tt>; you can click the
    package names to go to their homepage and follow the instructions on how to
    install them manually.
    </p>
    
    <h3>3.3 Installing optional packages</h3>
    
    <h4>Using R</h4>
    <p>
    If you are using R, install <b>RPy</b>
    (<a href="http://rpy.sourceforge.net/">http://rpy.sourceforge.net/</a>).&nbsp;
    This is a Python interface for the statistical programming language R (tested
    with version 0.4.6).
    </p>

    <h4>Reading DBF files</h4> 
    <p>
    If you need to use .dbf files (for example, those produced by ArcGIS),
    install <b>dbfpy</b> (you can get it from
    <a href="http://sourceforge.net/projects/dbfpy">here</a>).
    </p>
    
    <h4>Using MySQL</h4>
    <p>    
    If you are using a MySQL as a database, go ahead and install
    <b>MySQL-python</b>. Unfortunately the current version (1.2.2) has some issues
    with building on Mac OS X Leopard (10.5), so you can't install it using
    <tt>easy_install</tt>, since some source
    files need to be modified in order for it to build on Mac OS X.
    </p>
    
    <p>
      To install it, go to the sourceforge page for
      <a href="http://sourceforge.net/projects/mysql-python">MySQL-python</a> and
      download the tarball. Then follow the steps provided
      <a href="http://www.keningle.com/?p=11">here</a> in order to be
      able to build and install the package. Note that MySQL should be installed
      before you install the MySQL-python package.
      You may need to put /usr/local/mysql/bin into your path before installing
      mysql-python to avoid getting an error.
    </p>
    
    <p>
    You may get the following error after building and installing MySQL-python
    1.2.2 on 10.3.9:
    </p>
      
    <blockquote><i>
    ImportError: dlcompat: dyld:
    /Library/Frameworks/Python.framework/Versions/2.5/Resources/Python.app/Contents/MacOS/Python
    can't open library: /usr/local/mysql/lib/mysql/libmysqlclient_r.15.dylib (No
    such file or directory, errno = 2)
    </i></blockquote>
    
    <p>
      This may happen because the library it is looking for is in
      /usr/local/mysql/lib/, and not in a subfolder called mysql. Moving the files
      or creating aliases should fix the problem.
    </p>

    <h3>Step 3.4 Installing Trolltech QT and bindings for Python</h3>
    
    <p>
      Finally install the QT framework from Trolltech, and PyQt which is the Python
      bindings for it. PyQt also requires SIP to be installed before you can build
      it. Instructions on how to do this follows.
    </p>
    
    <p>
      <i>Note:</i>  The installation process for Mac OS X Tiger (10.4) is similar as to the one described here, but seems to vary from user to user for reasons we haven't been able to pin down.
      <a href="http://www.riverbankcomputing.com/pipermail/qscintilla/2007-July/000110.html">This
    page</a> has been useful to some users.
    
    <h4>Building QT</h4>
   
    <p>The <a href="http://trolltech.com/downloads/opensource/appdev/mac-os-cpp">&quot;Qt for Open Source C++ development on Mac OS&quot; page</a> has both source and binary distributions available.</p>
    
    <p>The binary distribution is under &quot;Additional downloads&quot;, and contains a standard Mac OS X installation package.</p>
    
    <p>Alternatively, you can install from source.  There are <a href="http://doc.trolltech.com/4.4/install-mac.html">instructions on the Qt site</a> for doing this.  The simple version is to unpack the source, and do:

    <pre>
    $ cd <i>path/to/</i>qt-mac-opensource-src-<i>version</i>
    $ sudo make install </pre>

    <p>This build will take a while.</p>

    <h4>Building SIP</h4>
    <p>
      First, get the SIP source from its <a href="http://www.riverbankcomputing.co.uk/software/sip/download">download page</a>.  Unpack it somewhere, and then build it using the following, optionally replacing <tt>/Library/Python/2.5/site-packages</tt> with the path to your Python site-packages directory:
    <pre>
    $ cd <i>path/to/</i>sip-<i>version</i>
    $ python configure.py -d /Library/Python/2.5/site-packages
    $ make
    $ sudo make install </pre>

    <h4>Building PyQt</h4>

    <p>First, get PyQt from its <a href="http://www.riverbankcomputing.co.uk/software/pyqt/download">download page</a>.  Be sure to get the Mac version.  Unpack it somewhere, and then build it using the following, optionally replacing <tt>/Library/Python/2.5/site-packages</tt> with the path to your Python site-packages directory:
    </p>
    <pre>
    $ cd <i>path/to/</i>PyQt-mac-gpl-4.4.4
    $ python configure.py -d /Library/Python/2.5/site-packages
    $ make
    $ sudo make install </pre>

    <p>Note that this build will also take a while.</p>
          
    <h2>
      Step 4: <a name="opus">Installing Opus and UrbanSim</a>
    </h2>
<p>Follow the directions on the <a href="downloading_opus_urbansim.html">Downloading the Opus/UrbanSim sample data and source code</a> page.</p>

    <h2>
      Step 5: <a name=environment>Defining Environment Variables for Opus and UrbanSim</a>
    </h2>
    <p>
      UrbanSim requires the following environment variables.&nbsp; The first tells
      the Python interpreter where to find the Opus/UrbanSim code. The second tells
      the system where to find your cached data and configurations.
    </p>

    <ul>
      <li>
    <b>PYTHONPATH</b> - This environment variable tells Python where to look for
    files outside of Python's 'site-packages' directory (which is the default
    location for Python installers). Change PYTHONPATH to include the path to
    the directory containing the packages opus_core, urbansim, and so forth,
    that you downloaded in Step 4, e.g. <tt>/Users/yourname/opus/src</tt>.
      </li>
      <li>
    <b>OPUS_HOME</b> - The Opus home directory (surprise). This includes
    subdirectories with sample data for Eugene and Seattle projects, output from
    runs, template configurations for running simulations using these projects,
    and probably your source code and documentation. This is the directory you
    downloaded from the zip file and installed in Step 4. So if you put this
    unzipped directory just in your home directory, set this variable to <tt>/Users/yourname/opus</tt>.
      </li>
    </ul>
    
    Optionally, depending on what you are using and where you store your data, you might want to set this variable as well.
    <ul>
      <li>
    <b>OPUS_DATA_PATH</b> (optional) - The directory where you keep your sample
    data and caches of data for particular runs. It defaults to the <tt>data</tt>
    subdirectory under <tt>OPUS_HOME</tt>, so if you leave the data at the default location
    from the zip file, don't set this variable.
      </li>
    </ul>
    
    How to set these environment variables depends on how you intend to use Opus and
    UrbanSim. One way is to set the variables globally in OS X, and the way to do
    that is via an XML file
    <tt>.MacOSX/environment.plist</tt> (note the
    leading dot) in your home directory. See
    <a href="http://developer.apple.com/qa/qa2001/qa1067.html">this
      article</a> for information about this. Here is some sample contents of the file
    for defining the required variables.  (Change &quot;yourname&quot; to
      your login name.)
    <pre>
      &lt;?xml version="1.0" encoding="UTF-8"?&gt;
      &lt;!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN"
      "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
      &lt;plist version="1.0"&gt;
      
      &lt;key&gt;PYTHONPATH&lt;/key&gt;
      &lt;string&gt;/Users/yourname/opus/src&lt;/string&gt;

      &lt;key&gt;OPUS_HOME&lt;/key&gt;
      &lt;string&gt;/Users/yourname/opus&lt;/string&gt;
      
      &lt;/dict&gt;
      &lt;/plist&gt; </pre>
    <p>
      You need to reboot your machine after editing
      the<tt> environment.plist </tt>file for
      the new definitions to be seen. Unfortunately,
      the<tt> environment.plist </tt>technique
      for setting environment variables on the Mac doesn't seem to work on all
      machines. If you have trouble, try putting the definition in a
      <tt>.bashrc </tt>file as well.
    </p>

    <p>
      If you mainly will access Opus and UrbanSim from a command shell, you can
      place the following lines in your
      <tt>.profile</tt> (again note the dot). If
      there is no such file, you can go ahead and create it.
    </p>
    <pre>
      export PYTHONPATH=<i>/path/to/opus/src</i>:$PYTHONPATH
      export OPUSPATH=<i>/path/to/opus</i> </pre>
    <p>
      Of course, replace <i><tt>/path/to/opus</tt></i> with the actual
      path to your opus directory. Also note that the settings made in
      <tt>.profile</tt> won't be effective until the next Terminal
      session.
    </p>

    <p>
      Finally, if you are going to be developing Opus and UrbanSim using an IDE,
      there is probably some way that you can set the
      <tt>PYTHONPATH</tt> to include opus on a
      per project basis if you don't want session-wide settings. You should note
      that you'll only be able to start Opus and UrbanSim from the IDE if you decide
      to do it this way.
    </p>


    <h2>
      Step 6: <a name=test>Testing your installation</a>
    </h2>
    <p>
      Follow <a href="test_install.html">these instructions</a> to test your
      installation.
    </p>

</body>

</html>

