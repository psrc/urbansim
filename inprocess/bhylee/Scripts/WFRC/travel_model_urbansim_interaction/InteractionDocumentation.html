<html>

<head>
<title>Estimation Documentation</title>
</head>

<body>


<h1> WFRC Travel Mode-UrbanSim Interaction Automation Script</h1>


<p>These perl script and SQL scripts read configuration from a parameter file,
and implement travel model UrbanSim interaction including:</p>
<ul>
  <li>importing data from travel model to UrbanSim,</li>
  <li>formatting data from travel model,</li>
  <li>creating UrbanSim parameter file as specified in script parameter file,
    and run UrbanSim,</li>
  <li>transforming UrbanSim continuation data from output database to scenario
    database,</li>
  <li>creating UrbanSim indicators tables,</li>
  <li>creating GIS data tables,</li>
  <li>formatting data for travel model,</li>
  <li>exporting UrbanSim output table to travel model.</li>
</ul>


<h3>1. INSTALL PERL AND MODULES</h3>


<p>a) Download ActivePerl from <a href="http://www.activestate.com/Products/Download/Download.plex?id=ActivePerl"> http://www.activestate.com/Products/Download/Download.plex?id=ActivePerl</a>,
and select ActivePerl 5.6.1 build 635 for Windows in MSI format. Since some modules haven't been yet ported
to ActivePerl 5.8. ActivePerl 5.6.1 is recommended. Downlad the installation file to hard disk drive.&nbsp;</p>


<p>b) Double click the downloaded file to begin the installation of Perl, go through the installation processes
using default setting. If you are using Win9x or WinNT4.0, Windows Installer is required. You can download the Windows Installer
for you OS from <a href="http://www.microsoft.com/msdownload/platformsdk/instmsi.htm"> http://www.microsoft.com/msdownload/platformsdk/instmsi.htm</a>&nbsp;</p>


<p>c) Open a command prompt window by clicking "Start" at the lower-left of you screen, clicking on "Run...",
typing "cmd" in the text field (if you're using Win9x, type "command"), clicking on OK.&nbsp;</p>


<p>d) In the command prompt window, type "ppm" to open Perl Package Manager. At the "PPM>" prompt, type the following
commands, each followed by an Enter. When prompted "Install package?", type 'y'.&nbsp;<br>
<br>
install DBI<br>
install DBD-mysql<br>
install XML-DOM</p>


<h3>2. CREATE PARAMETER FILE FOR AUTOMATED TRAVEL MODEL-URBANSIM INTERACTION</h3>


<p>The parameter file is in XML format; you need to specify UrbanSim installation
directory, travel model directory, dataset and years that travel model and
UrbanSim run. An example of the parameter file is included below:</p>


<p>&lt;?xml version="1.0" encoding="UTF-8" ?>&nbsp;<br>
&lt;travel-model-and-urbansim-interaction-parameters ><br>
&lt;!--Set up environment variables --><br>
	&lt;directory><br>
&nbsp;&nbsp;&nbsp; &lt;!-- keep the final directory divider "/" --><br>
&nbsp;&nbsp;&nbsp; &lt;urbansim-directory value="C:/Program Files/urbansim/UrbanSim2/"/><br>
&nbsp;&nbsp;&nbsp; &lt;urbansim-parameter-file value="C:/eclipse/workspace/Scripts/lmwang/travel_model_urbansim_interaction/WFRC_$year0_parameters_5yr_$year1.xml" /><br>
&nbsp;&nbsp;&nbsp; &lt;travel-model-directory value="C:/WFRC/DV31_UrbanSim_$year0/" /><br>
&nbsp;&nbsp;&nbsp; &lt;data-to-urbansim-directory value=&quot;C:/WFRC/DV31_UrbanSim_$year0/5UrbanSim/Uo/" /><br>
&nbsp;&nbsp;&nbsp; &lt;data-from-urbansim-directory value=&quot;C:/WFRC/DV31_UrbanSim_$year1/5UrbanSim/Ui/" /><br>
&nbsp;&nbsp;&nbsp; &lt;travel-model-batch-file value="HailMaryNoPauses.bat" /><br>
	&lt;/directory><br>
	&lt;dataset><br>
&nbsp;&nbsp;&nbsp; &lt;database contains="baseyear-data"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;mysql url="jdbc:mysql://elbe.cs.washington.edu/WFRC_1997_baseyear"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; username="mysqluser"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; password="MySQLPassword" /><br>
&nbsp;&nbsp;&nbsp; &lt;/database>&nbsp;<br>
&nbsp;&nbsp;&nbsp; &lt;database contains="scenario-data"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;mysql url="jdbc:mysql://elbe.cs.washington.edu/WFRC_$year0_scenario_5yr"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
username="mysqluser"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
password="MySQLPassword" /><br>
&nbsp;&nbsp;&nbsp; &lt;/database><br>
&nbsp;&nbsp;&nbsp; &lt;database contains="outputdata"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;mysql url="jdbc:mysql://elbe.cs.washington.edu/WFRC_1997_output_5yr_2003"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
username="mysqluser"&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
password="MySQLPassword" /><br>
&nbsp;&nbsp;&nbsp; &lt;/database><br>
	&lt;/dataset><br>
<br>
&lt;!--specify years travel model and UrbanSim run --><br>
	&lt;run><br>
&nbsp;&nbsp;&nbsp; &lt;year name="1997,2000,2003" ><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;!--optional, add &lt;run-urbansim> tag if you want to use a models section different from default settings<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;run-urbansim><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;models random-seed="0"><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;accessibility-model /><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;employment-location-choice-model weighted-probabilities="true"/><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;employment-relocation-choice-model /><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;household-relocation-choice-model /><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;household-transition-model /><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;employment-transition-model/><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;household-location-choice-model weighted-probabilities="true"/><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;land-price-model /><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;developer-model /><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;/models><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/run-urbansim><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -->&nbsp;<br>
&nbsp;&nbsp;&nbsp; &lt;/year><br>
	&lt;/run >&nbsp;<br>
&lt;/travel-model-and-urbansim-interaction-parameters ></p>


<p>If the UrbanSim parameter file specified in "urbansim-parameter-file" doesn't exist, the script will create a parameter file including &lt;dataset>, &lt;models> and &lt;exporter> sections. The &lt;dataset> section comes from dataset of script parameter file, &lt;models> section, comes from</p>
<blockquote>
  <p>	1) &lt;models> section specified in &lt;run> section(see example),</p>
  <p>	2) if no &lt;models> section specified, using default setting:</p>
  <p>		  &lt;models random-seed="0"><br>
		    &lt;accessibility-model /><br>
		    &lt;employment-location-choice-model weighted-probabilities="true"/><br>
		    &lt;employment-relocation-choice-model /><br>
		    &lt;household-relocation-choice-model /><br>
		    &lt;household-transition-model /><br>
		    &lt;employment-transition-model/><br>
		    &lt;household-location-choice-model weighted-probabilities="true"/><br>
		    &lt;land-price-model /><br>
		    &lt;developer-model-with-vacancy-adjustment /><br>
		  &lt;/models><br>
  </p>
</blockquote>
<p>&lt;exporter> section is set up as "&lt;exproter />". By default, all sql scripts are in the "sql_scripts" sub-directory of the directory of this
Perl script.</p>
<p>The patterns you can use in the directories, database name, table name, and sql query are:&nbsp;</p>
<ul>
  <li>		$baseyear_db_host, which is the host name of baseyear database, as specified at the dataset section.</li>
  <li>		$baseyear_db, which is the baseyear database name, as specified at the dataset section.</li>
  <li>		$base_year, which is the baseyear of UrbanSim dataset, as specified in base_year table in baseyear_db.</li>
  <li>		$year0, $year1, which are the starting year and end year per urbansim run,
    separately, for example, when running urbansim from 1977 to 2000, $year0 = 1997 and $year1 = 2000.&nbsp;</li>
  <li>		$scenario_db, which is the scenario database name, as specified at the dataset section.</li>
  <li>		$output_db, which is the scenario database name, as specified at the dataset section.</li>
</ul>
<p><b>Advanced features:</b></p>
<p>You can specify an &lt;run-urbansim> and &lt;models> section to override the default &lt;models> setting, which runs all models. you can also specify &lt;exchange-data> and &lt;format-data> section parallel to &lt;directory>, &lt;dataset>, and &lt;run> to meet your needs. Examples of &lt;exchange-data> and &lt;format-data> sections are as below:</p>
<p>	&lt;exchange-data><br>
&nbsp;&nbsp;&nbsp; &lt;from-travel-model-to-urbansim><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;table name="AccessLogsum"&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fields-defintion=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
FROM_ZONE_ID int,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
TO_ZONE_ID int,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
LOGSUM0 double,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
LOGSUM1 double,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
LOGSUM2 double<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; " /><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;table name="HighwayTimes"&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fields-defintion=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
FROM_ZONE_ID int,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
TO_ZONE_ID int,&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
HWYTIME double<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; " /><br>
&nbsp;&nbsp;&nbsp; &lt;/from-travel-model-to-urbansim><br>
&nbsp;&nbsp;&nbsp; &lt;from-urbansim-to-travel-model><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;table name="HHdistrib_joint_inclohi" /><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;table name="SEdata" /><br>
&nbsp;&nbsp;&nbsp; &lt;/from-urbansim-to-travel-model><br>
	&lt;/exchange-data></p>
<p>	&lt;format-data ><br>
&nbsp;&nbsp;&nbsp; &lt;format-data-from-travel-model&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sql-script-file="C:/eclipse/workspace/Scripts/lmwang/travel_model_urbansim_interaction/format_data_from_travel_model.sql" /><br>
&nbsp;&nbsp;&nbsp; &lt;format-data-for-travel-model&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sql-script-file="C:/eclipse/workspace/Scripts/lmwang/travel_model_urbansim_interaction/format_data_for_travel_model.sql" /><br>
&nbsp;&nbsp;&nbsp; &lt;create-indicators&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sql-script-file="C:/eclipse/workspace/Scripts/lmwang/travel_model_urbansim_interaction/urbansim_indicators.sql" /><br>
&nbsp;&nbsp;&nbsp; &lt;create-gis-data&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sql-script-file="C:/eclipse/workspace/Scripts/lmwang/travel_model_urbansim_interaction//output_data_to_grid_zone.sql" /><br>
&nbsp;&nbsp;&nbsp; &lt;output-to-continuation<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sql-script-file="C:/eclipse/workspace/Scripts/lmwang/travel_model_urbansim_interaction/output_to_continuation.sql" /><br>
	&lt;/format-data ></p>
<h3>3. RUN SCRIPT</h3>
<p>a) open a command prompt windows (please refer to 1-c about how to open a command prompt window). Change the current working directory to the
directory where you save the script, the SQL scripts have to be in the "sql_scripts" sub-directory of this directory.</p>
<p>b) At the command prompt, type:<br>
&nbsp;&nbsp;&nbsp; perl tu_automate.pl -f batchrun-parameter.xml</p>
<p>To see a list of command line switches available with tu_automate.pl type:<br>
&nbsp;&nbsp;&nbsp; perl tu_automate.pl -h</p>
<p>The tu_automate.pl script comes with some acceptance tests that verify it is working correctly. The parameter file and expected output UrbanSim parameter files for the tests are stored in the directory tests. To run the tests from a command line:<br>
&nbsp;&nbsp;&nbsp; perl tu_automate.pl -t</p>
<p>&nbsp;</p>
</body>
</html>
